<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Robin Gabriel Design</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: Arial, Helvetica, sans-serif;
    }
    
    :root {
      --text-color: #000000;
      --background-color: #ffffff;
      --accent-color: #000000;
      --hover-color: rgba(200, 200, 200, 0.3);
      --transition-speed: 0.5s;
    }
    
    body {
      background-color: var(--background-color);
      color: var(--text-color);
      overflow: hidden;
      transition: all var(--transition-speed) ease;
      width: 100vw;
      height: 100vh;
    }
    
    #container {
      position: relative;
      width: 100vw;
      height: 100vh;
      transition: all var(--transition-speed) ease;
    }
    
    #container:hover {
      background: radial-gradient(circle at var(--mouse-x) var(--mouse-y), 
                  var(--hover-color), transparent 50%);
    }
    
    /* Desktop split layout */
    #container.portfolio-mode,
    #container.contact-mode {
      width: 50vw;
      transform: translateX(50vw);
    }
    
    #location-info {
      position: absolute;
      top: 24px;
      left: 24px;
      z-index: 10;
      max-width: 300px;
    }
    
    #city {
      font-size: 14px;
      opacity: 0.7;
      font-weight: normal;
      line-height: 1.2;
    }
    
    /* Navigation container */
    #nav-container {
      position: absolute;
      top: 24px;
      right: 24px;
      display: flex;
      align-items: center;
      z-index: 10;
    }
    
    /* Brand title with hover menu */
    #brand-container {
      position: relative;
      margin-right: 24px;
    }

    #brand-title {
      font-family: Arial, Helvetica, sans-serif;
      font-weight: normal;
      font-size: 16px;
      letter-spacing: 1px;
      color: var(--text-color);
      cursor: pointer;
      transition: opacity 0.3s, transform 0.3s;
      opacity: 0.8;
      padding: 8px 0;
      text-transform: uppercase;
    }

    #brand-title:hover {
      opacity: 1;
      transform: translateY(-2px);
    }

    /* Vertical navigation menu */
    #nav-menu {
      position: absolute;
      top: 100%;
      left: 0;
      margin-top: 0;
      padding-top: 5px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      opacity: 0;
      transform: translateY(-10px);
      pointer-events: none;
      transition: opacity 0.3s ease, transform 0.3s ease;
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border-radius: 8px;
      padding: 15px;
      min-width: 120px;
    }

    #brand-container:hover #nav-menu,
    #brand-container.active #nav-menu {
      opacity: 1;
      transform: translateY(0);
      pointer-events: all;
    }

    #nav-menu:hover {
      opacity: 1;
      transform: translateY(0);
      pointer-events: all;
    }

    #nav-menu a {
      color: var(--text-color);
      text-decoration: none;
      font-size: 14px;
      letter-spacing: 1px;
      transition: opacity 0.3s, transform 0.3s;
      font-weight: normal;
      white-space: nowrap;
      cursor: pointer;
      padding: 8px 0;
    }

    #nav-menu a:hover {
      opacity: 0.7;
      transform: translateX(5px);
    }
    
    /* Earth mode toggle */
    #earth-toggle {
      background: none;
      border: none;
      color: var(--text-color);
      font-size: 18px;
      cursor: pointer;
      transition: transform 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    #earth-toggle:hover {
      transform: rotate(180deg);
    }
    
    .earth-icon {
      width: 18px;
      height: 18px;
      stroke: var(--text-color);
      fill: none;
      transition: all var(--transition-speed) ease;
    }
    
    #date-display {
      position: absolute;
      bottom: 24px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 14px;
      opacity: 0.7;
      z-index: 10;
      text-align: center;
      width: 90%;
      max-width: 500px;
      font-weight: normal;
    }
    
    #loading {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: var(--background-color);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      color: var(--text-color);
      gap: 20px;
    }
    
    .spinner {
      width: 40px;
      height: 40px;
      border: 3px solid rgba(0, 0, 0, 0.3);
      border-radius: 50%;
      border-top-color: var(--text-color);
      animation: spin 1s ease-in-out infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* Modal sections */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(255, 255, 255, 0.8);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      z-index: 100;
      padding: 40px 20px 20px;
      overflow-y: auto;
    }
    
    .modal-content {
      max-width: 900px;
      margin: 0 auto;
      color: var(--text-color);
      background: rgba(255, 255, 255, 0.1);
      padding: 30px;
      border-radius: 10px;
      backdrop-filter: blur(5px);
    }
    
    .modal-content h1 {
      font-size: 24px;
      margin-bottom: 20px;
      font-weight: normal;
    }
    
    .modal-content p {
      font-size: 16px;
      line-height: 1.6;
      margin-bottom: 20px;
      font-weight: normal;
    }
    
    .close-button {
      position: absolute;
      top: 20px;
      right: 20px;
      background: none;
      border: none;
      color: var(--text-color);
      font-size: 24px;
      cursor: pointer;
      z-index: 101;
    }
    
    /* Desktop split panels */
    .portfolio-panel,
    .contact-panel {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 50vw;
      height: 100vh;
      background: var(--background-color);
      z-index: 50;
      padding: 40px;
      overflow-y: auto;
      border-right: 1px solid var(--text-color);
    }
    
    .portfolio-panel.active,
    .contact-panel.active {
      display: block;
    }
    
    .portfolio-close,
    .contact-close {
      position: absolute;
      top: 20px;
      right: 20px;
      background: none;
      border: none;
      color: var(--text-color);
      font-size: 24px;
      cursor: pointer;
      z-index: 101;
    }
    
    /* Centered password sections */
    #password-section,
    #portfolio-password-section {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      text-align: center;
    }

    #password-section h1,
    #portfolio-password-section h1 {
      font-size: 18px;
      margin-bottom: 20px;
      font-weight: normal;
    }
    
    /* Password form styles */
    .password-form {
      display: flex;
      flex-direction: column;
      gap: 15px;
      align-items: center;
      max-width: 250px;
      width: 100%;
    }
    
    .password-input {
      background: rgba(0, 0, 0, 0.1);
      border: 1px solid var(--text-color);
      color: var(--text-color);
      padding: 8px 16px;
      font-size: 14px;
      font-family: Arial, Helvetica, sans-serif;
      border-radius: 5px;
      width: 100%;
      text-align: center;
      font-weight: normal;
    }
    
    .password-input::placeholder {
      color: rgba(0, 0, 0, 0.5);
    }
    
    .password-submit {
      background: var(--text-color);
      color: var(--background-color);
      border: none;
      padding: 8px 20px;
      font-size: 12px;
      font-family: Arial, Helvetica, sans-serif;
      cursor: pointer;
      border-radius: 5px;
      transition: opacity 0.3s;
      font-weight: normal;
    }
    
    .password-submit:hover {
      opacity: 0.8;
    }
    
    .error-message {
      color: #ff4444;
      font-size: 12px;
      text-align: center;
      font-weight: normal;
    }
    
    /* Portfolio gallery styles */
    .portfolio-gallery {
      width: 100%;
      max-height: 80vh;
      overflow-y: auto;
      margin-top: 20px;
      border-radius: 10px;
      background: var(--background-color);
      border: 1px solid var(--text-color);
      padding: 20px;
    }
    
    .portfolio-image {
      width: 100%;
      height: auto;
      margin-bottom: 20px;
      border-radius: 5px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      transition: transform 0.3s ease;
    }
    
    .portfolio-image:hover {
      transform: scale(1.02);
    }
    
    .portfolio-image:last-child {
      margin-bottom: 0;
    }
    
    /* Contact links */
    .contact-links {
      display: flex;
      flex-direction: column;
      gap: 15px;
      margin-top: 20px;
    }
    
    .contact-link {
      color: var(--text-color);
      text-decoration: none;
      font-size: 16px;
      transition: opacity 0.3s, transform 0.3s;
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: normal;
    }
    
    .contact-link:hover {
      opacity: 0.7;
      transform: translateX(5px);
    }
    
    /* Mobile Responsive Design */
    @media (max-width: 768px) {
      /* Disable desktop split layout on mobile */
      #container.portfolio-mode,
      #container.contact-mode {
        width: 100vw !important;
        transform: none !important;
      }
      
      .portfolio-panel,
      .contact-panel {
        display: none !important;
      }

      /* Much smaller navigation */
      #nav-container {
        top: 15px;
        right: 15px;
      }

      #brand-container {
        margin-right: 15px;
      }

      #brand-title {
        font-size: 13px;
        padding: 6px 0;
      }

      #nav-menu {
        padding: 10px;
        min-width: 100px;
        gap: 8px;
      }

      #nav-menu a {
        font-size: 11px;
        padding: 6px 0;
      }

      #location-info {
        top: 15px;
        left: 15px;
      }

      #city {
        font-size: 11px;
      }

      #date-display {
        bottom: 15px;
        font-size: 11px;
      }

      /* Compact Modal for Mobile */
      .modal {
        padding: 20px 10px 10px;
      }

      .modal-content {
        padding: 20px;
        border-radius: 15px;
      }

      .modal-content h1 {
        font-size: 18px;
        margin-bottom: 15px;
      }

      .modal-content p {
        font-size: 14px;
        margin-bottom: 15px;
      }

      .portfolio-gallery {
        padding: 15px;
        margin-top: 15px;
      }

      .portfolio-image {
        margin-bottom: 15px;
      }
    }

    /* Extra small mobile devices */
    @media (max-width: 480px) {
      #brand-title {
        font-size: 12px;
      }

      #nav-menu a {
        font-size: 10px;
      }

      #city {
        font-size: 10px;
      }

      #date-display {
        font-size: 10px;
      }

      .earth-icon {
        width: 14px;
        height: 14px;
      }
    }

    /* Large screen adjustments */
    @media (min-width: 1920px) {
      #brand-title {
        font-size: 18px;
      }
      
      #nav-menu a {
        font-size: 16px;
      }
      
      #city {
        font-size: 16px;
      }
      
      #date-display {
        font-size: 16px;
      }
    }
  </style>
</head>
<body>
  <div id="container">
    <div id="location-info">
      <div id="city">Loading location...</div>
    </div>

    <div id="nav-container">
      <div id="brand-container">
        <div id="brand-title">Robin Gabriel Design</div>
        <div id="nav-menu">
          <a href="#contact">CONTACT</a>
          <a href="#work">PRIVATE PORTFOLIO</a>
          <a href="#design">DESIGN</a>
        </div>
      </div>
      <button id="earth-toggle" aria-label="Toggle earth mode">
        <svg class="earth-icon" viewBox="0 0 24 24" width="18" height="18">
          <circle cx="12" cy="12" r="10"></circle>
          <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path>
          <path d="M2 12h20"></path>
        </svg>
      </button>
    </div>

    <div id="date-display"></div>

    <div id="loading">
      <div class="spinner"></div>
      <div>Loading Earth...</div>
    </div>
  </div>

  <!-- Desktop Contact Panel -->
  <div id="contact-panel" class="contact-panel">
    <button class="contact-close">&times;</button>
    <div id="contact-content">
      <h1>Contact</h1>
      <p>Get in touch with Robin Gabriel Design</p>
      <div class="contact-links">
        <a href="mailto:robingabrieldesign@gmail.com" class="contact-link">
          <span>üìß</span>
          <span>robingabrieldesign@gmail.com</span>
        </a>
        <a href="https://www.instagram.com/robingabrieldesign/" target="_blank" class="contact-link">
          <span>üì∑</span>
          <span>@robingabrieldesign</span>
        </a>
      </div>
    </div>
  </div>

  <!-- Desktop Portfolio Panel -->
  <div id="portfolio-panel" class="portfolio-panel">
    <button class="portfolio-close">&times;</button>
    <div id="portfolio-password-section">
      <h1>Enter Password</h1>
      <div class="password-form">
        <input type="password" id="portfolio-password" class="password-input" placeholder="Enter password">
        <button id="portfolio-submit" class="password-submit">ACCESS</button>
        <div id="portfolio-error" class="error-message" style="display: none;">Incorrect password</div>
      </div>
    </div>
    <div id="portfolio-content" style="display: none;">
      <h1>Portfolio</h1>
      <div class="portfolio-gallery">
        <img src="PORTFOLIO/ROBIN_USC_PORTFOLIO_Page_01 Large.jpeg" alt="Portfolio Page 1" class="portfolio-image">
        <img src="PORTFOLIO/ROBIN_USC_PORTFOLIO_Page_03 Large.jpeg" alt="Portfolio Page 3" class="portfolio-image">
        <img src="PORTFOLIO/ROBIN_USC_PORTFOLIO_Page_04 Large.jpeg" alt="Portfolio Page 4" class="portfolio-image">
        <img src="PORTFOLIO/ROBIN_USC_PORTFOLIO_Page_05 Large.jpeg" alt="Portfolio Page 5" class="portfolio-image">
        <img src="PORTFOLIO/ROBIN_USC_PORTFOLIO_Page_06 Large.jpeg" alt="Portfolio Page 6" class="portfolio-image">
        <img src="PORTFOLIO/ROBIN_USC_PORTFOLIO_Page_07 Large.jpeg" alt="Portfolio Page 7" class="portfolio-image">
        <img src="PORTFOLIO/ROBIN_USC_PORTFOLIO_Page_08 Large.jpeg" alt="Portfolio Page 8" class="portfolio-image">
        <img src="PORTFOLIO/ROBIN_USC_PORTFOLIO_Page_09 Large.jpeg" alt="Portfolio Page 9" class="portfolio-image">
        <img src="PORTFOLIO/ROBIN_USC_PORTFOLIO_Page_10 Large.jpeg" alt="Portfolio Page 10" class="portfolio-image">
        <img src="PORTFOLIO/ROBIN_USC_PORTFOLIO_Page_11 Large.jpeg" alt="Portfolio Page 11" class="portfolio-image">
        <img src="PORTFOLIO/ROBIN_USC_PORTFOLIO_Page_12 Large.jpeg" alt="Portfolio Page 12" class="portfolio-image">
        <img src="PORTFOLIO/ROBIN_USC_PORTFOLIO_Page_13 Large.jpeg" alt="Portfolio Page 13" class="portfolio-image">
        <img src="PORTFOLIO/ROBIN_USC_PORTFOLIO_Page_14 Large.jpeg" alt="Portfolio Page 14" class="portfolio-image">
        <img src="PORTFOLIO/ROBIN_USC_PORTFOLIO_Page_15 Large.jpeg" alt="Portfolio Page 15" class="portfolio-image">
        <img src="PORTFOLIO/ROBIN_USC_PORTFOLIO_Page_16 Large.jpeg" alt="Portfolio Page 16" class="portfolio-image">
        <img src="PORTFOLIO/ROBIN_USC_PORTFOLIO_Page_17 Large.jpeg" alt="Portfolio Page 17" class="portfolio-image">
        <img src="PORTFOLIO/ROBIN_USC_PORTFOLIO_Page_18 Large.jpeg" alt="Portfolio Page 18" class="portfolio-image">
        <img src="PORTFOLIO/ROBIN_USC_PORTFOLIO_Page_19 Large.jpeg" alt="Portfolio Page 19" class="portfolio-image">
        <img src="PORTFOLIO/ROBIN_USC_PORTFOLIO_Page_20 Large.jpeg" alt="Portfolio Page 20" class="portfolio-image">
        <img src="PORTFOLIO/ROBIN_USC_PORTFOLIO_Page_21 Large.jpeg" alt="Portfolio Page 21" class="portfolio-image">
        <img src="PORTFOLIO/ROBIN_USC_PORTFOLIO_Page_22 Large.jpeg" alt="Portfolio Page 22" class="portfolio-image">
        <img src="PORTFOLIO/ROBIN_USC_PORTFOLIO_Page_23 Large.jpeg" alt="Portfolio Page 23" class="portfolio-image">
        <img src="PORTFOLIO/ROBIN_USC_PORTFOLIO_Page_24 Large.jpeg" alt="Portfolio Page 24" class="portfolio-image">
        <img src="PORTFOLIO/ROBIN_USC_PORTFOLIO_Page_25 Large.jpeg" alt="Portfolio Page 25" class="portfolio-image">
        <img src="PORTFOLIO/ROBIN_USC_PORTFOLIO_Page_26 Large.jpeg" alt="Portfolio Page 26" class="portfolio-image">
        <img src="PORTFOLIO/ROBIN_USC_PORTFOLIO_Page_27 Large.jpeg" alt="Portfolio Page 27" class="portfolio-image">
        <img src="PORTFOLIO/ROBIN_USC_PORTFOLIO_Page_28 Large.jpeg" alt="Portfolio Page 28" class="portfolio-image">
        <img src="PORTFOLIO/ROBIN_USC_PORTFOLIO_Page_29 Large.jpeg" alt="Portfolio Page 29" class="portfolio-image">
        <img src="PORTFOLIO/ROBIN_USC_PORTFOLIO_Page_30 Large.jpeg" alt="Portfolio Page 30" class="portfolio-image">
        <img src="PORTFOLIO/ROBIN_USC_PORTFOLIO_Page_31 Large.jpeg" alt="Portfolio Page 31" class="portfolio-image">
        <img src="PORTFOLIO/ROBIN_USC_PORTFOLIO_Page_32 Large.jpeg" alt="Portfolio Page 32" class="portfolio-image">
        <img src="PORTFOLIO/ROBIN_USC_PORTFOLIO_Page_33 Large.jpeg" alt="Portfolio Page 33" class="portfolio-image">
        <img src="PORTFOLIO/ROBIN_USC_PORTFOLIO_Page_34 Large.jpeg" alt="Portfolio Page 34" class="portfolio-image">
        <img src="PORTFOLIO/ROBIN_USC_PORTFOLIO_Page_35 Large.jpeg" alt="Portfolio Page 35" class="portfolio-image">
        <img src="PORTFOLIO/ROBIN_USC_PORTFOLIO_Page_36 Large.jpeg" alt="Portfolio Page 36" class="portfolio-image">
        <img src="PORTFOLIO/ROBIN_USC_PORTFOLIO_Page_37 Large.jpeg" alt="Portfolio Page 37" class="portfolio-image">
        <img src="PORTFOLIO/ROBIN_USC_PORTFOLIO_Page_38 Large.jpeg" alt="Portfolio Page 38" class="portfolio-image">
        <img src="PORTFOLIO/ROBIN_USC_PORTFOLIO_Page_39 Large.jpeg" alt="Portfolio Page 39" class="portfolio-image">
        <img src="PORTFOLIO/ROBIN_USC_PORTFOLIO_Page_40 Large.jpeg" alt="Portfolio Page 40" class="portfolio-image">
        <img src="PORTFOLIO/ROBIN_USC_PORTFOLIO_Page_41 Large.jpeg" alt="Portfolio Page 41" class="portfolio-image">
        <img src="PORTFOLIO/ROBIN_USC_PORTFOLIO_Page_42 Large.jpeg" alt="Portfolio Page 42" class="portfolio-image">
        <img src="PORTFOLIO/ROBIN_USC_PORTFOLIO_Page_43 Large.jpeg" alt="Portfolio Page 43" class="portfolio-image">
        <img src="PORTFOLIO/ROBIN_USC_PORTFOLIO_Page_44 Large.jpeg" alt="Portfolio Page 44" class="portfolio-image">
        <img src="PORTFOLIO/ROBIN_USC_PORTFOLIO_Page_45 Large.jpeg" alt="Portfolio Page 45" class="portfolio-image">
      </div>
    </div>
  </div>

  <!-- Load Three.js from CDN -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>

  <script>
    // Main application script
    document.addEventListener('DOMContentLoaded', () => {
      console.log('Document loaded, initializing application...');
      
      // Global variables
      let scene, camera, renderer, controls;
      let earth, atmosphere, locationMarker;
      let isGlobeInitialized = false;
      let userLocation = null;
      let isEarthInverted = false;
      let isMobile = window.innerWidth < 768;
      let clock = new THREE.Clock();
      let sunLight, ambientLight;
      let dayTexture, nightTexture, normalTexture, specularTexture;
      let isPortfolioOpen = false;
      let isContactOpen = false;
      
      // DOM elements
      const container = document.getElementById('container');
      const loadingElement = document.getElementById('loading');
      const cityElement = document.getElementById('city');
      const dateElement = document.getElementById('date-display');
      const earthToggle = document.getElementById('earth-toggle');
      const brandContainer = document.getElementById('brand-container');
      const brandTitle = document.getElementById('brand-title');
      const portfolioPanel = document.getElementById('portfolio-panel');
      const contactPanel = document.getElementById('contact-panel');
      
      // Earth icons
      const normalEarthIcon = `<svg class="earth-icon" viewBox="0 0 24 24" width="18" height="18">
        <circle cx="12" cy="12" r="10"></circle>
        <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path>
        <path d="M2 12h20"></path>
      </svg>`;
      
      const invertedEarthIcon = `<svg class="earth-icon" viewBox="0 0 24 24" width="18" height="18">
        <circle cx="12" cy="12" r="10" fill="currentColor"></circle>
        <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z" stroke="white" fill="none"></path>
        <path d="M2 12h20" stroke="white"></path>
      </svg>`;
      
      // Initialize the application
      init();
      
      // Main initialization function
      function init() {
        console.log('Initializing 3D scene...');
        checkMobile();
        initScene();
        initEventListeners();
        getUserLocation();
        animate();
      }
      
      // Check if device is mobile
      function checkMobile() {
        isMobile = window.innerWidth < 768;
        console.log(`Device detected as ${isMobile ? 'mobile' : 'desktop'}`);
      }
      
      // Initialize Three.js scene
      function initScene() {
        try {
          // Create scene
          scene = new THREE.Scene();
          
          // Create camera with responsive positioning
          const aspect = window.innerWidth / window.innerHeight;
          camera = new THREE.PerspectiveCamera(75, aspect, 0.1, 1000);
          
          // Responsive camera positioning
          if (isMobile) {
            camera.position.z = 3.5;
          } else if (window.innerWidth > 1920) {
            camera.position.z = 2.2;
          } else {
            camera.position.z = 2.5;
          }
          
          // Create renderer with enhanced settings
          renderer = new THREE.WebGLRenderer({ 
            antialias: true, 
            alpha: true,
            powerPreference: "high-performance"
          });
          renderer.setSize(window.innerWidth, window.innerHeight);
          renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
          renderer.shadowMap.enabled = true;
          renderer.shadowMap.type = THREE.PCFSoftShadowMap;
          renderer.toneMapping = THREE.ACESFilmicToneMapping;
          renderer.toneMappingExposure = 1.2;
          container.appendChild(renderer.domElement);
          
          // Enhanced lighting setup
          ambientLight = new THREE.AmbientLight(0x404040, 0.8);
          scene.add(ambientLight);
          
          // Main sun light
          sunLight = new THREE.DirectionalLight(0xffffff, 1.2);
          sunLight.position.set(5, 3, 5);
          sunLight.castShadow = true;
          sunLight.shadow.mapSize.width = 2048;
          sunLight.shadow.mapSize.height = 2048;
          sunLight.shadow.camera.near = 0.5;
          sunLight.shadow.camera.far = 50;
          scene.add(sunLight);
          
          // Rim light for atmosphere effect
          const rimLight = new THREE.DirectionalLight(0x4488ff, 0.3);
          rimLight.position.set(-5, 0, -5);
          scene.add(rimLight);
          
          // Add orbit controls with responsive settings
          controls = new THREE.OrbitControls(camera, renderer.domElement);
          controls.enableDamping = true;
          controls.dampingFactor = 0.05;
          controls.rotateSpeed = 0.5;
          
          // Responsive control settings
          if (isMobile) {
            controls.minDistance = 2.8;
            controls.maxDistance = 6;
          } else if (window.innerWidth > 1920) {
            controls.minDistance = 1.8;
            controls.maxDistance = 4.5;
          } else {
            controls.minDistance = 2;
            controls.maxDistance = 5;
          }
          
          controls.autoRotate = true;
          controls.autoRotateSpeed = 0.3;
          controls.enableZoom = true;
          controls.zoomSpeed = 0.8;
          controls.enablePan = false;
          
          // Create enhanced stars
          createStars();
          
          // Create the enhanced globe
          createEnhancedGlobe();
          
          console.log('Scene initialized successfully');
        } catch (error) {
          console.error('Error initializing scene:', error);
          loadingElement.innerHTML = `<div>Error loading globe: ${error.message}</div>`;
        }
      }
      
      // Create enhanced stars background
      function createStars() {
        try {
          const starsGeometry = new THREE.BufferGeometry();
          const starsMaterial = new THREE.PointsMaterial({
            color: 0x000000,
            size: 0.5,
            transparent: true,
            opacity: 0.6,
            sizeAttenuation: true
          });
          
          const starsVertices = [];
          
          for (let i = 0; i < 3000; i++) {
            const x = (Math.random() - 0.5) * 2000;
            const y = (Math.random() - 0.5) * 2000;
            const z = (Math.random() - 0.5) * 2000;
            starsVertices.push(x, y, z);
          }
          
          starsGeometry.setAttribute('position', new THREE.Float32BufferAttribute(starsVertices, 3));
          
          const stars = new THREE.Points(starsGeometry, starsMaterial);
          scene.add(stars);
          console.log('Enhanced stars created successfully');
        } catch (error) {
          console.error('Error creating stars:', error);
        }
      }
      
      // Function to invert texture colors
      function invertTexture(texture) {
        const canvas = document.createElement('canvas');
        const context = canvas.getContext('2d');
        const img = texture.image;
        
        canvas.width = img.width;
        canvas.height = img.height;
        context.drawImage(img, 0, 0);
        
        const imageData = context.getImageData(0, 0, canvas.width, canvas.height);
        const data = imageData.data;
        
        // Invert colors
        for (let i = 0; i < data.length; i += 4) {
          data[i] = 255 - data[i];     // Red
          data[i + 1] = 255 - data[i + 1]; // Green
          data[i + 2] = 255 - data[i + 2]; // Blue
          // Alpha stays the same
        }
        
        context.putImageData(imageData, 0, 0);
        
        const invertedTexture = new THREE.Texture(canvas);
        invertedTexture.needsUpdate = true;
        invertedTexture.wrapS = THREE.RepeatWrapping;
        invertedTexture.wrapT = THREE.RepeatWrapping;
        
        return invertedTexture;
      }
      
      // Function to create thermal camera effect
      function createThermalTexture(texture) {
        const canvas = document.createElement('canvas');
        const context = canvas.getContext('2d');
        const img = texture.image;
        
        canvas.width = img.width;
        canvas.height = img.height;
        context.drawImage(img, 0, 0);
        
        const imageData = context.getImageData(0, 0, canvas.width, canvas.height);
        const data = imageData.data;
        
        // Convert to thermal camera effect (grayscale with heat map colors)
        for (let i = 0; i < data.length; i += 4) {
          const r = data[i];
          const g = data[i + 1];
          const b = data[i + 2];
          
          // Calculate luminance
          const luminance = 0.299 * r + 0.587 * g + 0.114 * b;
          
          // Create thermal effect based on luminance
          if (luminance < 64) {
            // Dark areas - deep blue/black
            data[i] = 0;     // Red
            data[i + 1] = 0; // Green
            data[i + 2] = Math.floor(luminance * 2); // Blue
          } else if (luminance < 128) {
            // Medium areas - blue to cyan
            data[i] = 0;     // Red
            data[i + 1] = Math.floor((luminance - 64) * 4); // Green
            data[i + 2] = 255; // Blue
          } else if (luminance < 192) {
            // Bright areas - cyan to yellow
            data[i] = Math.floor((luminance - 128) * 4);     // Red
            data[i + 1] = 255; // Green
            data[i + 2] = Math.floor(255 - (luminance - 128) * 4); // Blue
          } else {
            // Very bright areas - yellow to white
            data[i] = 255;     // Red
            data[i + 1] = 255; // Green
            data[i + 2] = Math.floor((luminance - 192) * 4); // Blue
          }
        }
        
        context.putImageData(imageData, 0, 0);
        
        const thermalTexture = new THREE.Texture(canvas);
        thermalTexture.needsUpdate = true;
        thermalTexture.wrapS = THREE.RepeatWrapping;
        thermalTexture.wrapT = THREE.RepeatWrapping;
        
        return thermalTexture;
      }
      
      // Create enhanced globe with theme-responsive textures
      function createEnhancedGlobe() {
        try {
          const globeGroup = new THREE.Group();
          scene.add(globeGroup);
          
          const textureLoader = new THREE.TextureLoader();
          textureLoader.crossOrigin = "Anonymous";
          
          // Create high-quality globe geometry
          const globeGeometry = new THREE.SphereGeometry(1, 128, 128);
          
          // Enhanced material with multiple texture layers
          const globeMaterial = new THREE.MeshPhongMaterial({
            shininess: 10,
            transparent: false
          });
          
          earth = new THREE.Mesh(globeGeometry, globeMaterial);
          earth.receiveShadow = true;
          earth.castShadow = true;
          globeGroup.add(earth);
          
          // Create atmosphere effect
          const atmosphereGeometry = new THREE.SphereGeometry(1.02, 64, 64);
          const atmosphereMaterial = new THREE.MeshPhongMaterial({
            color: 0x4488ff,
            transparent: true,
            opacity: 0.05,
            side: THREE.BackSide
          });
          
          atmosphere = new THREE.Mesh(atmosphereGeometry, atmosphereMaterial);
          globeGroup.add(atmosphere);
          
          // Load enhanced textures
          Promise.all([
            // Thermal camera texture (processed from day texture)
            new Promise((resolve) => {
              textureLoader.load(
                'https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/textures/planets/earth_atmos_2048.jpg',
                (texture) => {
                  texture.wrapS = THREE.RepeatWrapping;
                  texture.wrapT = THREE.RepeatWrapping;
                  dayTexture = createThermalTexture(texture);
                  resolve();
                },
                undefined,
                (error) => {
                  console.error('Error loading day texture:', error);
                  resolve();
                }
              );
            }),
            
            // Night lights texture
            new Promise((resolve) => {
              textureLoader.load(
                'https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/textures/planets/earth_lights_2048.png',
                (texture) => {
                  texture.wrapS = THREE.RepeatWrapping;
                  texture.wrapT = THREE.RepeatWrapping;
                  nightTexture = texture;
                  resolve();
                },
                undefined,
                (error) => {
                  console.error('Error loading night lights texture:', error);
                  resolve();
                }
              );
            }),
            
            // Normal map for surface detail
            new Promise((resolve) => {
              textureLoader.load(
                'https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/textures/planets/earth_normal_2048.jpg',
                (texture) => {
                  texture.wrapS = THREE.RepeatWrapping;
                  texture.wrapT = THREE.RepeatWrapping;
                  normalTexture = texture;
                  resolve();
                },
                undefined,
                (error) => {
                  console.error('Error loading normal map:', error);
                  resolve();
                }
              );
            }),
            
            // Specular map for water reflection
            new Promise((resolve) => {
              textureLoader.load(
                'https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/textures/planets/earth_specular_2048.jpg',
                (texture) => {
                  texture.wrapS = THREE.RepeatWrapping;
                  texture.wrapT = THREE.RepeatWrapping;
                  specularTexture = texture;
                  resolve();
                },
                undefined,
                (error) => {
                  console.error('Error loading specular map:', error);
                  resolve();
                }
              );
            })
          ]).then(() => {
            console.log('Enhanced textures loaded successfully');
            
            // Apply initial earth mode
            updateEarthMode(isEarthInverted);
            
            isGlobeInitialized = true;
            loadingElement.style.display = 'none';
            
            if (userLocation) {
              addLocationMarker(userLocation.latitude, userLocation.longitude);
            }
          }).catch((error) => {
            console.error('Error loading textures:', error);
            isGlobeInitialized = true;
            loadingElement.style.display = 'none';
          });
          
          console.log('Enhanced globe created successfully');
        } catch (error) {
          console.error('Error creating enhanced globe:', error);
          loadingElement.innerHTML = `<div>Error loading globe: ${error.message}</div>`;
        }
      }
      
      // Update earth mode (normal vs inverted)
      function updateEarthMode(inverted) {
        if (!earth || !earth.material || !dayTexture || !nightTexture) return;
        
        try {
          if (inverted) {
            // Inverted earth mode
            earth.material.map = invertTexture(dayTexture);
            earth.material.emissiveMap = invertTexture(nightTexture);
            earth.material.emissive = new THREE.Color(0x222222);
            earth.material.emissiveIntensity = 0.3;
          } else {
            // Thermal camera mode
            earth.material.map = dayTexture; // This is now the thermal texture
            earth.material.emissiveMap = null; // Remove night lights for thermal effect
            earth.material.emissive = new THREE.Color(0x000000);
            earth.material.emissiveIntensity = 0;
          }
          
          // Apply normal and specular maps
          if (normalTexture) {
            earth.material.normalMap = normalTexture;
            earth.material.normalScale = new THREE.Vector2(0.5, 0.5);
          }
          
          if (specularTexture && !inverted) {
            earth.material.specularMap = specularTexture;
          } else {
            earth.material.specularMap = null;
          }
          
          earth.material.needsUpdate = true;
          
        } catch (error) {
          console.error('Error updating earth mode:', error);
        }
      }
      
      // Convert latitude and longitude to 3D position with improved accuracy
      function latLongToVector3(lat, long, radius) {
        // Convert to radians
        const phi = (90 - lat) * (Math.PI / 180);
        const theta = (long + 180) * (Math.PI / 180);
        
        // Calculate 3D position
        const x = -(radius * Math.sin(phi) * Math.cos(theta));
        const z = radius * Math.sin(phi) * Math.sin(theta);
        const y = radius * Math.cos(phi);
        
        return new THREE.Vector3(x, y, z);
      }
      
      // Add enhanced location marker with improved positioning
      function addLocationMarker(lat, long) {
        try {
          userLocation = { latitude: lat, longitude: long };
          
          if (!isGlobeInitialized) {
            console.log('Globe not initialized yet, marker will be added when ready');
            return;
          }
          
          console.log(`Adding enhanced location marker at lat: ${lat}, long: ${long}`);
          
          if (locationMarker) {
            scene.remove(locationMarker);
          }
          
          locationMarker = new THREE.Group();
          
          // Use precise positioning
          const position = latLongToVector3(lat, long, 1.015);
          
          // Enhanced marker with arrow and label
          const markerGroup = new THREE.Group();

          // Create arrow pointing down to location
          const arrowGeometry = new THREE.ConeGeometry(0.015, 0.055, 8);
          const arrowMaterial = new THREE.MeshBasicMaterial({ 
            color: 0xff0000,
            transparent: false
          });
          const arrow = new THREE.Mesh(arrowGeometry, arrowMaterial);
          arrow.position.y = 0.035;
          arrow.rotation.x = Math.PI; // Point downward
          markerGroup.add(arrow);

          // Create text label with current location
          const canvas = document.createElement('canvas');
          const context = canvas.getContext('2d');
          canvas.width = 400;
          canvas.height = 100;

          // Set font and style
          context.font = '20px Arial, Helvetica, sans-serif';
          context.fillStyle = '#000000';
          context.textAlign = 'center';
          context.textBaseline = 'middle';

          // Get current location text from the city element
          const locationText = `You are Here ${cityElement.textContent}`;

          // Draw text
          context.fillText(locationText, canvas.width / 2, canvas.height / 2);

          // Create texture from canvas
          const textTexture = new THREE.Texture(canvas);
          textTexture.needsUpdate = true;

          // Create text plane
          const textGeometry = new THREE.PlaneGeometry(0.25, 0.06);
          const textMaterial = new THREE.MeshBasicMaterial({
            map: textTexture,
            transparent: true,
            alphaTest: 0.1
          });
          const textMesh = new THREE.Mesh(textGeometry, textMaterial);
          textMesh.position.y = 0.11;
          textMesh.lookAt(camera.position);
          markerGroup.add(textMesh);

          locationMarker.add(markerGroup);
          
          locationMarker.position.copy(position);
          scene.add(locationMarker);
          
          console.log('Enhanced location marker added successfully');
        } catch (error) {
          console.error('Error adding location marker:', error);
        }
      }
      
      // Get user's location with improved accuracy and debugging
      async function getUserLocation() {
        try {
          console.log('Starting location detection...');
          cityElement.textContent = 'Detecting location...';
          
          // First try to get precise GPS location
          if (navigator.geolocation) {
            console.log('Geolocation API is available');
            
            // Request permission explicitly
            const permission = await navigator.permissions.query({name: 'geolocation'});
            console.log('Geolocation permission status:', permission.state);
            
            if (permission.state === 'denied') {
              console.log('Geolocation permission denied, falling back to IP location');
              await fallbackToIpLocation();
              return;
            }
            
            // Try high accuracy first
            navigator.geolocation.getCurrentPosition(
              async (position) => {
                const { latitude, longitude, accuracy } = position.coords;
                console.log(`‚úÖ GPS Location found: ${latitude}, ${longitude} (accuracy: ${accuracy}m)`);
                
                try {
                  const locationInfo = await getLocationInfo(latitude, longitude);
                  updateLocationDisplay(locationInfo);
                  addLocationMarker(latitude, longitude);
                } catch (error) {
                  console.error('Error getting location info:', error);
                  cityElement.textContent = `Location: ${latitude.toFixed(4)}, ${longitude.toFixed(4)}`;
                  addLocationMarker(latitude, longitude);
                }
              },
              async (error) => {
                console.log('High accuracy GPS failed:', error.message);
                
                // Try standard accuracy
                navigator.geolocation.getCurrentPosition(
                  async (position) => {
                    const { latitude, longitude, accuracy } = position.coords;
                    console.log(`‚úÖ Standard GPS Location found: ${latitude}, ${longitude} (accuracy: ${accuracy}m)`);
                    
                    try {
                      const locationInfo = await getLocationInfo(latitude, longitude);
                      updateLocationDisplay(locationInfo);
                      addLocationMarker(latitude, longitude);
                    } catch (error) {
                      console.error('Error getting location info:', error);
                      cityElement.textContent = `Location: ${latitude.toFixed(4)}, ${longitude.toFixed(4)}`;
                      addLocationMarker(latitude, longitude);
                    }
                  },
                  async (error2) => {
                    console.log('Standard GPS also failed:', error2.message);
                    await fallbackToIpLocation();
                  },
                  { timeout: 15000, enableHighAccuracy: false, maximumAge: 300000 }
                );
              },
              { timeout: 8000, enableHighAccuracy: true, maximumAge: 60000 }
            );
          } else {
            console.log('Geolocation API not supported');
            await fallbackToIpLocation();
          }
        } catch (error) {
          console.error('Error in getUserLocation:', error);
          await fallbackToIpLocation();
        }
      }
      
      async function fallbackToIpLocation() {
        try {
          console.log('üåê Trying IP-based location...');
          cityElement.textContent = 'Getting IP location...';
          
          // Try ipapi.co first (most reliable)
          try {
            const response = await fetch('https://ipapi.co/json/', {
              timeout: 5000
            });
            
            if (!response.ok) {
              throw new Error(`HTTP ${response.status}`);
            }
            
            const data = await response.json();
            console.log('IP location data:', data);
            
            if (data.latitude && data.longitude && data.city) {
              console.log(`‚úÖ IP Location found: ${data.city}, ${data.country_name}`);
              
              const locationInfo = {
                city: data.city,
                country: data.country_name,
                region: data.region,
                coordinates: [data.longitude, data.latitude],
                timezone: data.timezone
              };
              
              updateLocationDisplay(locationInfo);
              addLocationMarker(data.latitude, data.longitude);
              return;
            }
          } catch (ipError) {
            console.log('ipapi.co failed:', ipError.message);
          }
          
          // Try ip-api.com as backup
          try {
            const response = await fetch('http://ip-api.com/json/', {
              timeout: 5000
            });
            
            if (!response.ok) {
              throw new Error(`HTTP ${response.status}`);
            }
            
            const data = await response.json();
            console.log('Backup IP location data:', data);
            
            if (data.lat && data.lon && data.city) {
              console.log(`‚úÖ Backup IP Location found: ${data.city}, ${data.country}`);
              
              const locationInfo = {
                city: data.city,
                country: data.country,
                region: data.regionName,
                coordinates: [data.lon, data.lat],
                timezone: data.timezone
              };
              
              updateLocationDisplay(locationInfo);
              addLocationMarker(data.lat, data.lon);
              return;
            }
          } catch (backupError) {
            console.log('Backup IP service failed:', backupError.message);
          }
          
          throw new Error('All IP location services failed');
        } catch (error) {
          console.error('All IP location attempts failed:', error);
          fallbackToTimezone();
        }
      }
      
      function fallbackToTimezone() {
        try {
          console.log('‚è∞ Using timezone fallback...');
          const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
          const parts = timezone.split('/');
          const city = parts[parts.length - 1].replace(/_/g, ' ');
          
          console.log(`‚úÖ Timezone location: ${city}`);
          
          const locationInfo = {
            city: city,
            country: parts[0] === 'America' ? 'United States' : '',
            coordinates: [0, 0], // Default coordinates
            timezone: timezone
          };
          
          updateLocationDisplay(locationInfo);
          addLocationMarker(0, 0); // Place at equator/prime meridian
        } catch (error) {
          console.error('Timezone fallback failed:', error);
          cityElement.textContent = 'Location unavailable';
        }
      }
      
      async function getLocationInfo(latitude, longitude) {
        try {
          console.log(`üîç Getting detailed location for: ${latitude}, ${longitude}`);
          
          // Use Nominatim (OpenStreetMap) for detailed location info
          const response = await fetch(
            `https://nominatim.openstreetmap.org/reverse?format=json&lat=${latitude}&lon=${longitude}&zoom=18&addressdetails=1`,
            {
              headers: {
                'User-Agent': 'RobinGabrielDesign/1.0'
              }
            }
          );
          
          if (!response.ok) {
            throw new Error(`HTTP ${response.status}`);
          }
          
          const data = await response.json();
          console.log('Detailed location data:', data);
          
          const addr = data.address || {};
          
          // Build detailed location string
          let locationParts = [];
          
          if (addr.house_number && addr.road) {
            locationParts.push(`${addr.house_number} ${addr.road}`);
          } else if (addr.road) {
            locationParts.push(addr.road);
          }
          
          if (addr.neighbourhood) {
            locationParts.push(addr.neighbourhood);
          } else if (addr.suburb) {
            locationParts.push(addr.suburb);
          }
          
          if (addr.city || addr.town || addr.village) {
            locationParts.push(addr.city || addr.town || addr.village);
          }
          
          if (addr.state) {
            locationParts.push(addr.state);
          }
          
          if (addr.country) {
            locationParts.push(addr.country);
          }
          
          const fullLocation = locationParts.join(', ');
          
          return {
            city: fullLocation || 'Unknown Location',
            country: addr.country || '',
            coordinates: [longitude, latitude],
            timezone: Intl.DateTimeFormat().resolvedOptions().timeZone
          };
        } catch (error) {
          console.error('Error getting detailed location:', error);
          
          // Fallback to basic coordinates display
          return {
            city: `${latitude.toFixed(4)}, ${longitude.toFixed(4)}`,
            country: '',
            coordinates: [longitude, latitude],
            timezone: Intl.DateTimeFormat().resolvedOptions().timeZone
          };
        }
      }
      
      function updateLocationDisplay(locationData) {
        try {
          console.log('üìç Updating location display:', locationData);
          
          cityElement.textContent = locationData.city;
          
          // Update the marker text if it exists
          if (locationMarker && userLocation) {
            // Remove old marker and create new one with updated text
            scene.remove(locationMarker);
            addLocationMarker(userLocation.latitude, userLocation.longitude);
          }
          
          updateDate();
          setInterval(updateDate, 1000);
          
          console.log('‚úÖ Location display updated successfully');
        } catch (error) {
          console.error('Error updating location display:', error);
        }
      }
      
      function updateDate() {
        try {
          const now = new Date();
          
          const dateOptions = {
            weekday: "short",
            month: "short",
            day: "2-digit",
            hour: "numeric",
            minute: "2-digit",
            second: "2-digit",
            hour12: true
          };
          
          const dateFormatter = new Intl.DateTimeFormat("en-US", dateOptions);
          dateElement.textContent = dateFormatter.format(now);
        } catch (error) {
          console.error("Error updating date:", error);
        }
      }
      
      function onWindowResize() {
        try {
          checkMobile();
          
          // Responsive camera and renderer adjustments
          if ((isPortfolioOpen || isContactOpen) && !isMobile) {
            camera.aspect = (window.innerWidth * 0.5) / window.innerHeight;
            renderer.setSize(window.innerWidth * 0.5, window.innerHeight);
          } else {
            camera.aspect = window.innerWidth / window.innerHeight;
            renderer.setSize(window.innerWidth, window.innerHeight);
          }
          
          camera.updateProjectionMatrix();
          
          // Responsive camera positioning
          if (isMobile) {
            camera.position.z = Math.max(camera.position.z, 3.5);
            controls.minDistance = 2.8;
            controls.maxDistance = 6;
          } else if (window.innerWidth > 1920) {
            camera.position.z = Math.min(camera.position.z, 2.2);
            controls.minDistance = 1.8;
            controls.maxDistance = 4.5;
          } else {
            controls.minDistance = 2;
            controls.maxDistance = 5;
          }
        } catch (error) {
          console.error("Error handling window resize:", error);
        }
      }
      
      function animate() {
        try {
          requestAnimationFrame(animate);
          
          const delta = clock.getDelta();
          
          // Animate location marker
          if (locationMarker) {
            const time = clock.getElapsedTime();
            // Make text always face camera
            const textMesh = locationMarker.children[0]?.children[1];
            if (textMesh) {
              textMesh.lookAt(camera.position);
            }
          }
          
          // Update atmosphere effect
          if (atmosphere) {
            atmosphere.rotation.y += delta * 0.1;
          }
          
          controls.update();
          renderer.render(scene, camera);
        } catch (error) {
          console.error("Error in animation loop:", error);
        }
      }
      
      // Show contact in desktop layout
      function showContactDesktop() {
        if (isMobile) return;
        
        console.log('Showing contact desktop');
        
        // Close portfolio if open
        if (isPortfolioOpen) {
          hidePortfolioDesktop();
        }
        
        isContactOpen = true;
        container.classList.add('contact-mode');
        contactPanel.classList.add('active');
        
        // Adjust renderer size for split view
        camera.aspect = (window.innerWidth * 0.5) / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth * 0.5, window.innerHeight);
      }
      
      // Hide contact desktop layout
      function hideContactDesktop() {
        isContactOpen = false;
        container.classList.remove('contact-mode');
        contactPanel.classList.remove('active');
        
        // Reset renderer size
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
      }
      
      // Show portfolio in desktop layout
      function showPortfolioDesktop() {
        if (isMobile) return;
        
        console.log('Showing portfolio desktop');
        
        // Close contact if open
        if (isContactOpen) {
          hideContactDesktop();
        }
        
        isPortfolioOpen = true;
        container.classList.add('portfolio-mode');
        portfolioPanel.classList.add('active');
        
        // Adjust renderer size for split view
        camera.aspect = (window.innerWidth * 0.5) / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth * 0.5, window.innerHeight);
      }
      
      // Hide portfolio desktop layout
      function hidePortfolioDesktop() {
        isPortfolioOpen = false;
        container.classList.remove('portfolio-mode');
        portfolioPanel.classList.remove('active');
        
        // Reset renderer size
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
        
        // Reset portfolio state
        document.getElementById('portfolio-password-section').style.display = 'block';
        document.getElementById('portfolio-content').style.display = 'none';
        document.getElementById('portfolio-password').value = '';
        document.getElementById('portfolio-error').style.display = 'none';
      }
      
      function initEventListeners() {
        try {
          window.addEventListener('resize', onWindowResize);
          
          // Earth mode toggle
          earthToggle.addEventListener('click', () => {
            isEarthInverted = !isEarthInverted;
            earthToggle.innerHTML = isEarthInverted ? invertedEarthIcon : normalEarthIcon;
            updateEarthMode(isEarthInverted);
          });
          
          // Enhanced mobile and desktop menu handling
          if (isMobile) {
            brandTitle.addEventListener('click', (e) => {
              e.stopPropagation();
              brandContainer.classList.toggle('active');
            });
            
            document.addEventListener('click', (e) => {
              if (!e.target.closest('#brand-container')) {
                brandContainer.classList.remove('active');
              }
            });
            
            document.querySelector('#nav-menu').addEventListener('click', (e) => {
              e.stopPropagation();
            });
          } else {
            let hoverTimeout;
            
            brandContainer.addEventListener('mouseenter', () => {
              clearTimeout(hoverTimeout);
              brandContainer.classList.add('active');
            });
            
            brandContainer.addEventListener('mouseleave', () => {
              hoverTimeout = setTimeout(() => {
                brandContainer.classList.remove('active');
              }, 200);
            });
            
            const navMenu = document.querySelector('#nav-menu');
            navMenu.addEventListener('mouseenter', () => {
              clearTimeout(hoverTimeout);
              brandContainer.classList.add('active');
            });
            
            navMenu.addEventListener('mouseleave', () => {
              hoverTimeout = setTimeout(() => {
                brandContainer.classList.remove('active');
              }, 200);
            });
          }
          
          document.addEventListener('mousemove', (e) => {
            document.documentElement.style.setProperty('--mouse-x', `${e.clientX}px`);
            document.documentElement.style.setProperty('--mouse-y', `${e.clientY}px`);
          });
          
          document.addEventListener('touchstart', (e) => {
            if (e.touches.length === 1) {
              const touch = e.touches[0];
              document.documentElement.style.setProperty('--mouse-x', `${touch.clientX}px`);
              document.documentElement.style.setProperty('--mouse-y', `${touch.clientY}px`);
            }
          });
          
          // Create modals for mobile
          createContactModal();
          createWorkModal();
          
          // Desktop contact panel event listeners
          const contactClose = document.querySelector('.contact-close');
          contactClose.addEventListener('click', hideContactDesktop);
          
          // Desktop portfolio panel event listeners
          const portfolioClose = document.querySelector('.portfolio-close');
          const portfolioPassword = document.getElementById('portfolio-password');
          const portfolioSubmit = document.getElementById('portfolio-submit');
          const portfolioError = document.getElementById('portfolio-error');
          
          portfolioClose.addEventListener('click', hidePortfolioDesktop);
          
          function checkPortfolioPassword() {
            const password = portfolioPassword.value;
            if (password === 'privateclientonly') {
              document.getElementById('portfolio-password-section').style.display = 'none';
              document.getElementById('portfolio-content').style.display = 'block';
              portfolioError.style.display = 'none';
            } else {
              portfolioError.style.display = 'block';
              portfolioPassword.value = '';
            }
          }
          
          portfolioSubmit.addEventListener('click', checkPortfolioPassword);
          portfolioPassword.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
              checkPortfolioPassword();
            }
          });
          
          const contactLink = document.querySelector('a[href="#contact"]');
          const workLink = document.querySelector('a[href="#work"]');
          const designLink = document.querySelector('a[href="#design"]');
          
          contactLink.addEventListener('click', (e) => {
            e.preventDefault();
            if (isMobile) {
              document.getElementById('contact-modal').style.display = 'block';
            } else {
              showContactDesktop();
            }
            brandContainer.classList.remove('active');
          });
          
          workLink.addEventListener('click', (e) => {
            e.preventDefault();
            if (isMobile) {
              document.getElementById('work-modal').style.display = 'block';
            } else {
              showPortfolioDesktop();
            }
            brandContainer.classList.remove('active');
          });
          
          designLink.addEventListener('click', (e) => {
            e.preventDefault();
            window.location.href = 'design.html';
            brandContainer.classList.remove('active');
          });
          
          console.log('Event listeners initialized successfully');
        } catch (error) {
          console.error("Error initializing event listeners:", error);
        }
      }
      
      function createContactModal() {
        const modal = document.createElement('div');
        modal.id = 'contact-modal';
        modal.className = 'modal';
        
        modal.innerHTML = `
          <button class="close-button">&times;</button>
          <div class="modal-content">
            <h1>Contact</h1>
            <p>Get in touch with Robin Gabriel Design</p>
            <div class="contact-links">
              <a href="mailto:robingabrieldesign@gmail.com" class="contact-link">
                <span>üìß</span>
                <span>robingabrieldesign@gmail.com</span>
              </a>
              <a href="https://www.instagram.com/robingabrieldesign/" target="_blank" class="contact-link">
                <span>üì∑</span>
                <span>@robingabrieldesign</span>
              </a>
            </div>
          </div>
        `;
        
        document.body.appendChild(modal);
        
        const closeButton = modal.querySelector('.close-button');
        
        closeButton.addEventListener('click', () => {
          modal.style.display = 'none';
        });
        
        modal.addEventListener('click', (e) => {
          if (e.target === modal) {
            modal.style.display = 'none';
          }
        });
      }
      
      function createWorkModal() {
        const modal = document.createElement('div');
        modal.id = 'work-modal';
        modal.className = 'modal';
        
        modal.innerHTML = `
          <button class="close-button">&times;</button>
          <div class="modal-content">
            <div id="password-section">
              <h1>Enter Password</h1>
              <div class="password-form">
                <input type="password" id="work-password" class="password-input" placeholder="Enter password">
                <button id="password-submit" class="password-submit">ACCESS</button>
                <div id="password-error" class="error-message" style="display: none;">Incorrect password</div>
              </div>
            </div>
            <div id="portfolio-section" style="display: none;">
              <h1>Portfolio</h1>
              <div class="portfolio-gallery">
                <img src="PORTFOLIO/ROBIN_USC_PORTFOLIO_Page_01 Large.jpeg" alt="Portfolio Page 1" class="portfolio-image">
                <img src="PORTFOLIO/ROBIN_USC_PORTFOLIO_Page_03 Large.jpeg" alt="Portfolio Page 3" class="portfolio-image">
                <img src="PORTFOLIO/ROBIN_USC_PORTFOLIO_Page_04 Large.jpeg" alt="Portfolio Page 4" class="portfolio-image">
                <img src="PORTFOLIO/ROBIN_USC_PORTFOLIO_Page_05 Large.jpeg" alt="Portfolio Page 5" class="portfolio-image">
                <img src="PORTFOLIO/ROBIN_USC_PORTFOLIO_Page_06 Large.jpeg" alt="Portfolio Page 6" class="portfolio-image">
                <img src="PORTFOLIO/ROBIN_USC_PORTFOLIO_Page_07 Large.jpeg" alt="Portfolio Page 7" class="portfolio-image">
                <img src="PORTFOLIO/ROBIN_USC_PORTFOLIO_Page_08 Large.jpeg" alt="Portfolio Page 8" class="portfolio-image">
                <img src="PORTFOLIO/ROBIN_USC_PORTFOLIO_Page_09 Large.jpeg" alt="Portfolio Page 9" class="portfolio-image">
                <img src="PORTFOLIO/ROBIN_USC_PORTFOLIO_Page_10 Large.jpeg" alt="Portfolio Page 10" class="portfolio-image">
                <img src="PORTFOLIO/ROBIN_USC_PORTFOLIO_Page_11 Large.jpeg" alt="Portfolio Page 11" class="portfolio-image">
                <img src="PORTFOLIO/ROBIN_USC_PORTFOLIO_Page_12 Large.jpeg" alt="Portfolio Page 12" class="portfolio-image">
                <img src="PORTFOLIO/ROBIN_USC_PORTFOLIO_Page_13 Large.jpeg" alt="Portfolio Page 13" class="portfolio-image">
                <img src="PORTFOLIO/ROBIN_USC_PORTFOLIO_Page_14 Large.jpeg" alt="Portfolio Page 14" class="portfolio-image">
                <img src="PORTFOLIO/ROBIN_USC_PORTFOLIO_Page_15 Large.jpeg" alt="Portfolio Page 15" class="portfolio-image">
                <img src="PORTFOLIO/ROBIN_USC_PORTFOLIO_Page_16 Large.jpeg" alt="Portfolio Page 16" class="portfolio-image">
                <img src="PORTFOLIO/ROBIN_USC_PORTFOLIO_Page_17 Large.jpeg" alt="Portfolio Page 17" class="portfolio-image">
                <img src="PORTFOLIO/ROBIN_USC_PORTFOLIO_Page_18 Large.jpeg" alt="Portfolio Page 18" class="portfolio-image">
                <img src="PORTFOLIO/ROBIN_USC_PORTFOLIO_Page_19 Large.jpeg" alt="Portfolio Page 19" class="portfolio-image">
                <img src="PORTFOLIO/ROBIN_USC_PORTFOLIO_Page_20 Large.jpeg" alt="Portfolio Page 20" class="portfolio-image">
                <img src="PORTFOLIO/ROBIN_USC_PORTFOLIO_Page_21 Large.jpeg" alt="Portfolio Page 21" class="portfolio-image">
                <img src="PORTFOLIO/ROBIN_USC_PORTFOLIO_Page_22 Large.jpeg" alt="Portfolio Page 22" class="portfolio-image">
                <img src="PORTFOLIO/ROBIN_USC_PORTFOLIO_Page_23 Large.jpeg" alt="Portfolio Page 23" class="portfolio-image">
                <img src="PORTFOLIO/ROBIN_USC_PORTFOLIO_Page_24 Large.jpeg" alt="Portfolio Page 24" class="portfolio-image">
                <img src="PORTFOLIO/ROBIN_USC_PORTFOLIO_Page_25 Large.jpeg" alt="Portfolio Page 25" class="portfolio-image">
                <img src="PORTFOLIO/ROBIN_USC_PORTFOLIO_Page_26 Large.jpeg" alt="Portfolio Page 26" class="portfolio-image">
                <img src="PORTFOLIO/ROBIN_USC_PORTFOLIO_Page_27 Large.jpeg" alt="Portfolio Page 27" class="portfolio-image">
                <img src="PORTFOLIO/ROBIN_USC_PORTFOLIO_Page_28 Large.jpeg" alt="Portfolio Page 28" class="portfolio-image">
                <img src="PORTFOLIO/ROBIN_USC_PORTFOLIO_Page_29 Large.jpeg" alt="Portfolio Page 29" class="portfolio-image">
                <img src="PORTFOLIO/ROBIN_USC_PORTFOLIO_Page_30 Large.jpeg" alt="Portfolio Page 30" class="portfolio-image">
                <img src="PORTFOLIO/ROBIN_USC_PORTFOLIO_Page_31 Large.jpeg" alt="Portfolio Page 31" class="portfolio-image">
                <img src="PORTFOLIO/ROBIN_USC_PORTFOLIO_Page_32 Large.jpeg" alt="Portfolio Page 32" class="portfolio-image">
                <img src="PORTFOLIO/ROBIN_USC_PORTFOLIO_Page_33 Large.jpeg" alt="Portfolio Page 33" class="portfolio-image">
                <img src="PORTFOLIO/ROBIN_USC_PORTFOLIO_Page_34 Large.jpeg" alt="Portfolio Page 34" class="portfolio-image">
                <img src="PORTFOLIO/ROBIN_USC_PORTFOLIO_Page_35 Large.jpeg" alt="Portfolio Page 35" class="portfolio-image">
                <img src="PORTFOLIO/ROBIN_USC_PORTFOLIO_Page_36 Large.jpeg" alt="Portfolio Page 36" class="portfolio-image">
                <img src="PORTFOLIO/ROBIN_USC_PORTFOLIO_Page_37 Large.jpeg" alt="Portfolio Page 37" class="portfolio-image">
                <img src="PORTFOLIO/ROBIN_USC_PORTFOLIO_Page_38 Large.jpeg" alt="Portfolio Page 38" class="portfolio-image">
                <img src="PORTFOLIO/ROBIN_USC_PORTFOLIO_Page_39 Large.jpeg" alt="Portfolio Page 39" class="portfolio-image">
                <img src="PORTFOLIO/ROBIN_USC_PORTFOLIO_Page_40 Large.jpeg" alt="Portfolio Page 40" class="portfolio-image">
                <img src="PORTFOLIO/ROBIN_USC_PORTFOLIO_Page_41 Large.jpeg" alt="Portfolio Page 41" class="portfolio-image">
                <img src="PORTFOLIO/ROBIN_USC_PORTFOLIO_Page_42 Large.jpeg" alt="Portfolio Page 42" class="portfolio-image">
                <img src="PORTFOLIO/ROBIN_USC_PORTFOLIO_Page_43 Large.jpeg" alt="Portfolio Page 43" class="portfolio-image">
                <img src="PORTFOLIO/ROBIN_USC_PORTFOLIO_Page_44 Large.jpeg" alt="Portfolio Page 44" class="portfolio-image">
                <img src="PORTFOLIO/ROBIN_USC_PORTFOLIO_Page_45 Large.jpeg" alt="Portfolio Page 45" class="portfolio-image">
              </div>
            </div>
          </div>
        `;
        
        document.body.appendChild(modal);
        
        const closeButton = modal.querySelector('.close-button');
        const passwordInput = modal.querySelector('#work-password');
        const passwordSubmit = modal.querySelector('#password-submit');
        const passwordError = modal.querySelector('#password-error');
        const passwordSection = modal.querySelector('#password-section');
        const portfolioSection = modal.querySelector('#portfolio-section');
        
        function checkPassword() {
          const password = passwordInput.value;
          if (password === 'privateclientonly') {
            passwordSection.style.display = 'none';
            portfolioSection.style.display = 'block';
            passwordError.style.display = 'none';
          } else {
            passwordError.style.display = 'block';
            passwordInput.value = '';
          }
        }
        
        passwordSubmit.addEventListener('click', checkPassword);
        
        passwordInput.addEventListener('keypress', (e) => {
          if (e.key === 'Enter') {
            checkPassword();
          }
        });
        
        closeButton.addEventListener('click', () => {
          modal.style.display = 'none';
          passwordSection.style.display = 'block';
          portfolioSection.style.display = 'none';
          passwordInput.value = '';
          passwordError.style.display = 'none';
        });
        
        modal.addEventListener('click', (e) => {
          if (e.target === modal) {
            modal.style.display = 'none';
            passwordSection.style.display = 'block';
            portfolioSection.style.display = 'none';
            passwordInput.value = '';
            passwordError.style.display = 'none';
          }
        });
      }
    });
  </script>
</body>
</html>